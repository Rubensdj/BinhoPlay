<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAM√çLIA M√ÅFIA - CENTRAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #d4af37; --dark: #0a0a0a; --card: #1a1a1a; --text: #e0e0e0; --red: #ff4444; --rose: #8b0000; }
        
        /* Reset e Scroll */
        html, body { height: 100%; background: var(--dark); color: var(--text); font-family: 'Roboto', sans-serif; margin: 0; padding: 0; scroll-behavior: smooth; }
        
        nav { background: #000; padding: 15px; border-bottom: 2px solid var(--gold); display: flex; justify-content: center; gap: 15px; position: sticky; top: 0; z-index: 9999; }
        nav a { color: var(--gold); text-decoration: none; font-family: 'Cinzel', serif; font-size: 0.8em; cursor: pointer; font-weight: bold; }

        header { text-align: center; padding: 30px 10px; background: #000; border-bottom: 1px solid #333; }
        h1 { font-family: 'Cinzel', serif; color: #fff; margin: 0; font-size: 1.8em; letter-spacing: 3px; }
        .sub-header { color: var(--gold); font-size: 0.7em; letter-spacing: 2px; margin-top: 5px; }

        .container { max-width: 1200px; margin: auto; padding: 15px; min-height: 100vh; }
        .section { display: none; }
        .active { display: block; }

        .panel { background: var(--card); padding: 15px; border-radius: 8px; border: 1px solid #333; margin-bottom: 20px; }
        
        /* Estilo da Roleta */
        .wheel-box { position: relative; width: 320px; height: 320px; margin: 20px auto; }
        #canvas { width: 100%; height: 100%; border: 5px solid var(--gold); border-radius: 50%; background: #111; }
        .seta-roleta { 
            position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent;
            border-top: 30px solid var(--gold); z-index: 10;
        }

        /* Tabelas e Inputs */
        .table-wrapper { overflow-x: auto; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; background: #151515; font-size: 0.85em; min-width: 400px; }
        th { background: #222; color: var(--gold); padding: 10px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #333; }
        
        textarea { width: 100%; height: 120px; background: #000; color: #00ff00; border: 1px solid #444; padding: 10px; border-radius: 5px; font-family: monospace; box-sizing: border-box; }
        .btn { background: var(--gold); color: black; border: none; padding: 12px; font-weight: bold; cursor: pointer; border-radius: 4px; width: 100%; margin: 5px 0; text-transform: uppercase; }
        
        .tag { padding: 3px 6px; border-radius: 4px; font-weight: bold; font-size: 0.7em; }
        .tag-ok { background: var(--gold); color: black; }
    </style>
</head>
<body>

<nav>
    <a onclick="showSection('dash')">RANKING</a>
    <a onclick="showSection('gestao')">LISTAS</a>
    <a onclick="showSection('roleta')">ROLETA</a>
</nav>

<header>
    <h1>FAM√çLIA M√ÅFIA</h1>
    <div class="sub-header">LEALDADE ACIMA DE TUDO üåπ</div>
</header>

<div class="container">
    
    <div id="dash" class="section active">
        <div class="panel">
            <h3>üèÜ Elite (Ranking Semanal)</h3>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Membro</th><th>Atividade</th><th>Moedas</th><th>Ba√∫</th></tr></thead>
                    <tbody id="bodyRanking"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="gestao" class="section">
        <div class="panel">
            <h3>üì• Processar Nova Lista</h3>
            <select id="tipoInput" class="btn" style="background:#222; color:white;">
                <option value="missao">TAREFAS DI√ÅRIAS (C)</option>
                <option value="doacao">DOA√á√ÉO NO BANCO (ü™ô)</option>
            </select>
            <input type="number" id="valorInput" value="500" class="btn" style="background:#222; color:white; text-align:center;">
            <textarea id="textoLista" placeholder="Cole a lista aqui..."></textarea>
            <button class="btn" onclick="processarLista()">‚úÖ Somar Pontos</button>
            <button class="btn" style="background:#600; color:white; margin-top:20px;" onclick="resetSemana()">üîÑ Zerar Semana</button>
        </div>
        <div class="panel">
            <h3>üë• Gerenciar Soldados (<span id="countM">0</span>)</h3>
            <div id="listaMembrosGestao"></div>
        </div>
    </div>

    <div id="roleta" class="section">
        <div class="panel" style="text-align:center;">
            <h3>üé∞ Sorteio da M√°fia</h3>
            <div class="wheel-box">
                <div class="seta-roleta"></div>
                <canvas id="canvas" width="400" height="400"></canvas>
            </div>
            <h2 id="resRoleta" style="color:var(--gold); margin: 20px 0;">AGUARDANDO GIRO...</h2>
            <textarea id="listaRoleta" placeholder="Um pr√™mio por linha..." oninput="drawWheel()">Envelope 100&#10;Envelope 500&#10;Foguete&#10;Anel&#10;Tente de Novo</textarea>
            <button class="btn" id="btnGirar" onclick="girarRoleta()" style="font-size: 1.2em; height: 60px;">GIRAR ROLETA</button>
        </div>
    </div>

</div>

<script>
    let db = JSON.parse(localStorage.getItem('mafia_vFinal')) || { familia: [], blacklist: [] };

    function save() { localStorage.setItem('mafia_vFinal', JSON.stringify(db)); render(); }

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'roleta') {
            setTimeout(drawWheel, 100); // Garante que o canvas carregue ao abrir a aba
        }
        window.scrollTo(0,0);
    }

    function processarLista() {
        const txt = document.getElementById('textoLista').value;
        const val = parseInt(document.getElementById('valorInput').value) || 0;
        const tipo = document.getElementById('tipoInput').value;
        const linhas = txt.split('\n');
        let c = 0;

        linhas.forEach(l => {
            const m = l.match(/\d+[-]\s*(.+)/);
            if(m) {
                const nome = m[1].trim();
                if(nome && nome.length > 1) {
                    let mem = db.familia.find(f => f.nome === nome);
                    if(!mem) { mem = { nome, c: 0, d: 0 }; db.familia.push(mem); }
                    if(tipo === 'missao') mem.c += val; else mem.d += val;
                    c++;
                }
            }
        });
        alert(c + " Membros Atualizados!");
        document.getElementById('textoLista').value = "";
        save();
    }

    function getBau(c, d) {
        if(c >= 2400 && d >= 6000) return "120K üíé";
        if(c >= 1200 && d >= 3000) return "60K üí∞";
        if(c >= 500 && d >= 700)   return "24K ü™ô";
        if(c >= 500)               return "8K üì¶";
        return "---";
    }

    function render() {
        document.getElementById('countM').innerText = db.familia.length;
        const bR = document.getElementById('bodyRanking');
        bR.innerHTML = "";
        db.familia.sort((a,b) => b.c - a.c).forEach(m => {
            const bau = getBau(m.c, m.d);
            bR.innerHTML += `<tr><td>${m.nome}</td><td>${m.c}C</td><td>${m.d}ü™ô</td><td><span class="tag ${bau !== '---' ? 'tag-ok' : ''}">${bau}</span></td></tr>`;
        });
        
        const lG = document.getElementById('listaMembrosGestao');
        lG.innerHTML = db.familia.map((m, i) => `
            <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #333;">
                <span>${m.nome}</span>
                <button onclick="delM(${i})" style="color:red; background:none; border:none;">Remover</button>
            </div>
        `).join('');
    }

    function delM(i) { if(confirm("Remover?")) { db.familia.splice(i, 1); save(); } }
    function resetSemana() { if(confirm("Zerar tudo?")) { db.familia.forEach(m => { m.c=0; m.d=0; }); save(); } }

    // --- L√ìGICA DA ROLETA (CANVAS) ---
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let angleAtual = 0;

    function drawWheel() {
        const itens = document.getElementById('listaRoleta').value.split('\n').filter(t => t.trim() !== "");
        if (itens.length === 0) return;

        const sliceAngle = (2 * Math.PI) / itens.length;
        ctx.clearRect(0, 0, 400, 400);

        itens.forEach((texto, i) => {
            const angulo = angleAtual + i * sliceAngle;
            
            // Desenha a fatia
            ctx.fillStyle = (i % 2 === 0) ? "#111" : "#d4af37";
            ctx.beginPath();
            ctx.moveTo(200, 200);
            ctx.arc(200, 200, 200, angulo, angulo + sliceAngle);
            ctx.fill();

            // Desenha o texto
            ctx.save();
            ctx.translate(200, 200);
            ctx.rotate(angulo + sliceAngle / 2);
            ctx.textAlign = "right";
            ctx.fillStyle = (i % 2 === 0) ? "#d4af37" : "#000";
            ctx.font = "bold 16px Roboto";
            ctx.fillText(texto.substring(0, 15), 180, 5);
            ctx.restore();
        });
    }

    function girarRoleta() {
        const btn = document.getElementById('btnGirar');
        btn.disabled = true;
        let velocidade = Math.random() * 0.4 + 0.4; // Velocidade inicial
        let desaceleracao = 0.985; // Suavidade da parada

        function animar() {
            angleAtual += velocidade;
            drawWheel();
            velocidade *= desaceleracao;

            if (velocidade > 0.002) {
                requestAnimationFrame(animar);
            } else {
                btn.disabled = false;
                processarVencedor();
            }
        }
        animar();
    }

    function processarVencedor() {
        const itens = document.getElementById('listaRoleta').value.split('\n').filter(t => t.trim() !== "");
        const sliceAngle = (2 * Math.PI) / itens.length;
        
        // Ajuste para o marcador no topo (-90 graus)
        let anguloFinal = (1.5 * Math.PI - angleAtual) % (2 * Math.PI);
        if (anguloFinal < 0) anguloFinal += 2 * Math.PI;
        
        const indice = Math.floor(anguloFinal / sliceAngle);
        document.getElementById('resRoleta').innerText = "VENCEDOR: " + itens[indice];
    }

    render();
    setTimeout(drawWheel, 500); // Desenha a roleta no primeiro carregamento
</script>
</body>
</html>
